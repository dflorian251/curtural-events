/* @license GNU-GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function($,Drupal,once){'use strict';Drupal.behaviors.readMore={attach:function(context,settings){var node_readMore='.contingut .field--name-field-view-more a.read-more';$(once('node_readMore',node_readMore,context)).each(function(){var isKeyAction=false;var literals=[Drupal.t('Show more'),Drupal.t('Close'),Drupal.t('of the main text'),Drupal.t('the block of the expanded main text')];var sronly='<span class="sr-only">'+literals[2]+'</span>';$(node_readMore).html(literals[0]+' '+sronly);$('.contingut .field--name-field-view-more a.hidden-read-more').html(literals[1]+' <span class="sr-only">'+literals[3]+'</span>');$(node_readMore).click(function(e){e.preventDefault();$(this).parent('.field--name-field-view-more').toggleClass('active');if(!isKeyAction)$(this).toggleClass('visually-hidden');else isKeyAction=false;$(this).toggleClass("active").attr('aria-expanded',($(this).attr('aria-expanded')==='false').toString());var contentMoreSiblings=$(this).siblings('.content-read-more');contentMoreSiblings.attr('aria-hidden','false');var closebutton=contentMoreSiblings.find('.hidden-read-more');closebutton.attr('aria-hidden',(closebutton.attr('aria-hidden')==="false").toString());}).on('focus',function(){if(isKeyAction){$(this).removeClass('visually-hidden');isKeyAction=false;}}).on('keydown',onKeyDownCallback).on('blur',function(){if($(this).hasClass('active'))$(this).addClass('visually-hidden').attr('aria-hidden','false');});$('.contingut .field--name-field-view-more a.hidden-read-more').click(function(e){e.preventDefault();if($(this).parent().parents('.field--name-field-view-more').hasClass('active')){$(this).parent().parents('.field--name-field-view-more').toggleClass('active');$(this).parent().parent('.content-read-more').siblings('.read-more').toggleClass("active visually-hidden").attr('aria-expanded',"false").attr('tabindex',0).attr('aria-hidden',"false");sronly='<span class="sr-only">'+literals[2]+'</span>';$(this).parent().parent('.content-read-more').attr('aria-hidden',"true");$(this).attr('aria-hidden',($(this).attr('aria-hidden')=="false").toString()).attr('aria-expanded',($(this).attr('aria-expanded')=="false").toString());var btnReadMore=$(this).parent().parent('.content-read-more').siblings('.read-more');btnReadMore.html(literals[0]+' '+sronly);if(isKeyAction)btnReadMore.addClass("minerva-focus").focus();btnReadMore.focus();}}).on('keydown',onKeyDownCallback);function onKeyDownCallback(e){isKeyAction=[9,13,32].indexOf(e.keyCode)!=-1;}});}};Drupal.behaviors.targetBlank={attach:function(context,settings){var lang=$('html').attr('lang');var linkExternTitle={'ca':'Obre en una finestra nova','es':'Abrir en una ventana nueva','en':'Open in a new window'};$(' a, button',context).each(function(){if($(this).attr('target')==='_blank'&&!$(this).hasClass('read-more')){$(this).append('<span class="sr-only"> '+linkExternTitle[lang]+'</span>');$(this).attr('title',linkExternTitle[lang]);}if($(this).hasClass('file'))$(this).attr("role","link");});}};Drupal.behaviors.menuBehavior={attach:function(context,settings){let menu=$('#menu-ciutat-bcn-v1');let categoria=menu.find('.level-0 > li.active');if(categoria.length){let portada=categoria.find('.wrapper-second .active-trail');if(!portada.length)categoria.find('.wrapper-second li').first().addClass('active-trail');}$('#header').on('click','.minimitzat',function(e){if(categoria.length)categoria.addClass('open');});}};Drupal.behaviors.focusBarcelonacat={attach:function(context,settings){$('body').on('focus','*:not(.bcn-brand, .bcn-brand *)',function(e){e.stopPropagation();var target=e.currentTarget;$(target).keyup(function(event){var code=event.keyCode||event.which;if(code===9)$(target).addClass('bcn-focus');});}).on('blur','*:not(.bcn-brand, .bcn-brand *)',function(e){e.stopPropagation();var target=e.currentTarget;$(target).removeClass('bcn-focus');});}};})(jQuery,Drupal,once);;
(function($,Drupal){'use strict';Drupal.behaviors.barcelonacat_theme_affix={attach:function(context,settings){var toggleAffix=function(affixElement,scrollElement,wrapper){var height=affixElement.outerHeight(),top=wrapper.offset().top;if(scrollElement.scrollTop()>=top){wrapper.height(height);affixElement.addClass("affix");}else{affixElement.removeClass("affix");wrapper.height('auto');}};$('[data-toggle="affix"]').each(function(){var ele=$(this),wrapper=$('<div></div>');ele.before(wrapper);$(window).on('scroll resize',function(){toggleAffix(ele,$(this),wrapper);});toggleAffix(ele,$(window),wrapper);});}};})(jQuery,Drupal);;
(function($){$(document).ready(function(e){$('[data-taguejar]').on('click','a',taguejar);$('[data-taguejar] [data-video]').on('click',taguejar);$('[data-taguejar]').on('click','.nav-esquerra, .nav-dreta',taguejarFletOwl);function taguejar(e){var category,label,action;var language=$('html').attr('lang').toUpperCase();category=$(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar');if($(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar').indexOf('Capçalera interna')>-1){action=$(this).closest('[data-taguejar]').find('h3').text()+'-';action+=$.trim(e.currentTarget.firstChild.data)+'-';action+=language;label=$(this).attr('href');}else if($(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar').indexOf('Promos')>-1){if($(e.currentTarget).offsetParent().find('h2').length===0)label=$.trim($(e.currentTarget).closest('[class="content-promo"]').find('h2').text())+' - '+$.trim(e.currentTarget.firstChild.data);else label=$.trim($(e.currentTarget).offsetParent().find('h2').text())+' - '+$.trim(e.currentTarget.firstChild.data);action=$(e.currentTarget).attr('href');}else if($(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar').indexOf('Noticies')>-1)if($(e.currentTarget).attr('href'))if(!$(e.currentTarget).offsetParent().hasClass('ajuntament-actualitat-nav')){label=$.trim(e.currentTarget.firstChild.data);action=$(e.currentTarget).attr('href');}else{label='Mes noticies';action=$(e.currentTarget).attr('href');}else{label='Play';action=$(e.currentTarget).attr('data-video');}else if($(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar').indexOf('agenda')>-1){label=$.trim($(e.currentTarget).text());action=$(e.currentTarget).attr('href');}else{if($(e.currentTarget).closest('[data-taguejar]').attr('data-taguejar').indexOf('eixos')>-1)if($(e.currentTarget).attr('href')!='#')if(!$(e.currentTarget).hasClass('play'))if($(e.currentTarget).parent().attr('class')==='cat'){label=$.trim($(e.currentTarget).text());action=$(e.currentTarget).attr('href');}else{label=$(e.currentTarget).closest('.item-destacat').attr('data-cat')+' - link - '+$.trim($(e.currentTarget).text());action=$(e.currentTarget).attr('href');}else{label='Play - '+$(e.currentTarget).offsetParent().siblings('.cat').text();action=$(e.currentTarget).attr('href');}else{label=$.trim($(e.currentTarget).text());action=$.trim($(e.currentTarget).text());}}callAnalytics_lameva(category,label,action);}function taguejarFletOwl(){var category,label,action;category=$(this).parents('.carousel').attr('data-taguejar');label='Fletxa Carrusel';if($(this).hasClass('nav-esquerra'))action='Anterior';else{if($(this).hasClass('nav-dreta'))action='Següent';}callAnalytics_lameva(category,label,action);}});function callAnalytics_lameva(_category,_label,_action){console.log(_category+', '+encodeURI(_label)+', '+_action);}Drupal.behaviors.bcn_theme_tags={attach:function(context,settings){$('.view-coreos-font-magica').on('click','.calendar-view-table button',function(e){category='Calendari – Font Magica';label=$('html').attr('lang').toUpperCase();action=$(this).attr('data-date');callAnalytics_lameva(category,label,action);});$('.view-coreos-font-magica .calendar-view-pager .pager__next a').on('click',function(e){category='Calendari – Font Magica';action='Fletxa-Seg';label=$(this).attr('href');label=label.split('?');label=label[1].split('&');label.forEach(function(element){if(element.indexOf('next=')==0){time=element.split('=')[1];time=new Date(time*1000);month=((time.getMonth()+1)<10)?'0'+(time.getMonth()+1):(time.getMonth()+1);label=month+'-'+time.getFullYear();}});callAnalytics_lameva(category,label,action);});$('.view-coreos-font-magica .calendar-view-pager .pager__previous a').on('click',function(e){category='Calendari – Font Magica';action='Fletxa-Ant';label=$(this).attr('href');label=label.split('?');label=label[1].split('&');label.forEach(function(element){if(element.indexOf('previous=')==0){time=element.split('=')[1];time=new Date(time*1000);month=((time.getMonth()+1)<10)?'0'+(time.getMonth()+1):(time.getMonth()+1);label=month+'-'+time.getFullYear();}});callAnalytics_lameva(category,label,action);});$('.node-mapa_asia .info-mapa a.btn').on('click',function(e){category='Planol – Font Magica';action='Com s’hi va-'+$('html').attr('lang').toUpperCase();label=$(this).attr('href');callAnalytics_lameva(category,label,action);});}};})(jQuery);;
